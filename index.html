<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Palm • Beach Menu</title>
    
    <!-- FUENTES PREMIUM -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <style>
        /* * ==========================================
         * 1. SYSTEM DESIGN (LUXURY SAND BEACH)
         * ==========================================
         */
        :root {
            /* PALETA TULUM / ARENA */
            --primary: #1B2631; /* Azul Nocturno Profundo (Textos) */
            --accent: #C59D5F;  /* Dorado Arena / Camel (Acciones) - Adiós Tiffany */
            --accent-hover: #A38048;
            
            /* SUPERFICIES LUMINOSAS BEIGE */
            --bg-body: #F4F1EA; /* Beige Crema Suave */
            --bg-gradient: linear-gradient(to bottom, #F9F7F2, #F0ECE6);
            --bg-card: #FFFFFF; /* Blanco Puro */
            --bg-glass-header: rgba(244, 241, 234, 0.9); /* Efecto Vidrio Beige */
            --border-subtle: rgba(197, 157, 95, 0.2); /* Bordes dorados muy sutiles */
            
            /* TIPOGRAFÍA ALTO CONTRASTE */
            --font-title: 'Playfair Display', serif;
            --font-body: 'Inter', sans-serif;
            
            --text-main: #2C3E50; /* Gris Petróleo */
            --text-muted: #7F8C8D; /* Gris Piedra */
            --text-light: #FFFFFF;
            
            /* UI ELEMENTS - ORGÁNICOS */
            --radius-md: 20px; 
            --radius-lg: 30px;
            --shadow-card: 0 10px 30px rgba(197, 157, 95, 0.08); /* Sombra cálida muy suave */
            --shadow-float: 0 15px 30px rgba(197, 157, 95, 0.25);
            
            --anim-ease: cubic-bezier(0.22, 1, 0.36, 1);
        }

        * {
            box-sizing: border-box; margin: 0; padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-body);
            color: var(--text-main);
            background-color: var(--bg-body);
            background-image: var(--bg-gradient);
            overflow-x: hidden;
            font-size: 16px;
            line-height: 1.5;
            min-height: 100vh;
            /* Transición suave para el cambio de fondo */
            transition: background-image 0.8s ease-in-out;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        /* Utilidades */
        .hidden { display: none !important; }
        img { display: block; width: 100%; height: auto; }
        button { border: none; background: none; font-family: inherit; cursor: pointer; color: inherit; }
        input { border: none; background: none; font-family: inherit; color: inherit; outline: none; }

        /* * ==========================================
         * 2. LOADER (Arena)
         * ==========================================
         */
        #app-loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-body); z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; transition: opacity 0.6s ease;
        }
        .spinner {
            width: 50px; height: 50px;
            border: 3px solid rgba(197, 157, 95, 0.2);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s infinite cubic-bezier(0.55, 0.15, 0.45, 0.85);
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* * ==========================================
         * 3. HOME VISUAL HUB (Luminoso)
         * ==========================================
         */
        #home-view {
            min-height: 100vh; position: relative; z-index: 10;
            transition: transform 0.6s var(--anim-ease), opacity 0.6s ease;
            transform: translateX(0); opacity: 1;
            padding-bottom: 20px;
        }

        #home-view.inactive {
            transform: translateX(-20%) scale(0.98);
            opacity: 0; pointer-events: none;
        }

        .home-header {
            position: absolute; top: 0; left: 0; width: 100%;
            padding: 50px 20px 20px; z-index: 20; text-align: center;
            background: linear-gradient(to bottom, rgba(244, 241, 234, 0.95), transparent);
            display: flex; flex-direction: column; align-items: center;
        }
        .brand-logo {
            font-family: var(--font-title); font-size: 2.2rem;
            font-weight: 800; color: var(--primary);
            letter-spacing: 1px; text-transform: uppercase;
            margin-bottom: 15px;
        }

        /* BOTONES SOCIALES (Estilo Arena) */
        .home-actions {
            display: flex; gap: 12px; margin-bottom: 10px; flex-wrap: wrap; justify-content: center;
        }
        .btn-social {
            display: flex; align-items: center; gap: 8px;
            padding: 10px 20px; 
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid var(--border-subtle);
            border-radius: 30px; 
            color: var(--primary); font-size: 0.85rem;
            text-transform: uppercase; letter-spacing: 1px;
            backdrop-filter: blur(5px); transition: all 0.3s;
            text-decoration: none; font-weight: 600;
            box-shadow: 0 4px 10px rgba(197, 157, 95, 0.05);
        }
        .btn-social:hover {
            background: var(--accent); color: #fff; border-color: var(--accent);
            transform: translateY(-2px);
        }
        .btn-social.reserve {
            background: var(--primary); color: #fff; border: none;
        }
        .btn-social.reserve:hover {
            background: var(--accent);
        }

        .category-grid {
            display: grid; grid-template-columns: 1fr; height: 100vh;
        }
        @media (min-width: 768px) { .category-grid { grid-template-columns: repeat(3, 1fr); } }

        .category-card {
            position: relative; height: 100%; min-height: 33vh;
            overflow: hidden; cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.4);
        }
        
        .cat-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; transition: transform 1.2s var(--anim-ease);
            filter: brightness(0.95) contrast(1.02); /* Más natural */
        }
        
        .cat-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.1); 
            transition: background 0.4s ease;
        }
        .cat-title {
            font-family: var(--font-title); color: #fff;
            font-size: 2.5rem; font-style: italic; font-weight: 700;
            letter-spacing: 0.5px; text-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }
        .category-card:hover .cat-bg { transform: scale(1.05); }

        /* * ==========================================
         * 4. MENU DETAILED VIEW (Limpio y Beige)
         * ==========================================
         */
        #menu-view {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: transparent; /* Fondo transparente para ver la playa beige */
            overflow-y: auto;
            transform: translateX(100%); transition: transform 0.6s var(--anim-ease);
            z-index: 20; scroll-behavior: smooth;
        }
        #menu-view.active { transform: translateX(0); }

        /* Header Sticky Beige */
        .menu-header-container {
            position: sticky; top: 0; z-index: 100;
            background: var(--bg-glass-header);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--border-subtle);
            box-shadow: 0 4px 30px rgba(197, 157, 95, 0.05);
        }

        .nav-controls {
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px 20px; gap: 15px;
        }

        .btn-menu-back {
            display: flex; flex-direction: column; justify-content: center; gap: 6px;
            width: 36px; height: 36px; padding: 4px;
            background: white; border-radius: 50%;
            box-shadow: 0 2px 10px rgba(197, 157, 95, 0.1);
            align-items: center;
        }
        .hamburger-line {
            width: 18px; height: 2px; background-color: var(--primary);
            border-radius: 2px; transition: all 0.3s;
        }
        
        .search-wrapper {
            flex: 1; position: relative;
            background: white; 
            border: 1px solid var(--border-subtle);
            border-radius: 30px; padding: 10px 20px;
            display: flex; align-items: center;
            transition: all 0.3s;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.02);
        }
        .search-wrapper:focus-within { border-color: var(--accent); box-shadow: 0 4px 15px rgba(197, 157, 95, 0.15); }
        .search-icon { opacity: 0.6; width: 18px; margin-right: 10px; color: var(--accent); }
        .search-input { width: 100%; font-size: 0.95rem; color: var(--text-main); font-family: var(--font-body); }
        .search-input::placeholder { color: var(--text-muted); font-style: italic; }

        /* View Toggle */
        .view-controls-container { position: relative; display: flex; align-items: center; }
        .btn-view-trigger {
            width: 38px; height: 38px; border-radius: 50%;
            background: white; border: 1px solid var(--border-subtle);
            color: var(--accent); display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 10px rgba(197, 157, 95, 0.1);
            animation: pulse-sand 3s infinite;
        }
        .btn-view-trigger.stop-pulse { animation: none; }
        
        @keyframes pulse-sand {
            0% { box-shadow: 0 0 0 0 rgba(197, 157, 95, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(197, 157, 95, 0); }
            100% { box-shadow: 0 0 0 0 rgba(197, 157, 95, 0); }
        }

        .view-options-popover {
            position: absolute; top: 50px; right: 0;
            background: white; border: 1px solid var(--border-subtle);
            border-radius: 16px; padding: 8px;
            display: flex; gap: 5px;
            opacity: 0; visibility: hidden; transform: translateY(-10px);
            transition: all 0.3s var(--anim-ease);
            box-shadow: 0 10px 40px rgba(197, 157, 95, 0.15); width: auto; white-space: nowrap;
        }
        .view-options-popover.show { opacity: 1; visibility: visible; transform: translateY(0); }

        .view-btn { padding: 8px; border-radius: 10px; color: var(--text-muted); transition: all 0.2s; }
        .view-btn.active { background: var(--accent); color: white; }
        .view-btn:hover { background: #F9F7F2; }
        .view-btn svg { width: 20px; height: 20px; }

        /* Macro Pills (Categorías) */
        .macro-cats-scroll {
            display: flex; overflow-x: auto; gap: 10px;
            padding: 5px 20px 15px 20px; scrollbar-width: none;
        }
        .macro-cats-scroll::-webkit-scrollbar { display: none; }

        .macro-pill {
            padding: 8px 20px;
            border: 1px solid var(--border-subtle); border-radius: 30px;
            font-family: var(--font-body); font-size: 0.9rem; font-weight: 500;
            color: var(--text-main); white-space: nowrap;
            letter-spacing: 0.5px; transition: all 0.3s ease;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }
        .macro-pill.active {
            background: var(--accent); color: white; border-color: var(--accent);
            font-weight: 600; box-shadow: 0 4px 12px rgba(197, 157, 95, 0.3);
        }

        /* Sub Links (Navegación secundaria) */
        .sub-nav {
            display: flex; overflow-x: auto; padding: 0 20px; gap: 30px;
            scrollbar-width: none; border-top: 1px solid var(--border-subtle);
            background: rgba(255,255,255,0.4);
        }
        .sub-nav::-webkit-scrollbar { display: none; }

        .sub-link {
            padding: 14px 0; font-size: 0.9rem; font-weight: 500;
            color: var(--text-muted); white-space: nowrap; position: relative;
            cursor: pointer; transition: color 0.3s;
        }
        .sub-link.active { color: var(--accent); font-weight: 700; }
        .sub-link::after {
            content: ''; position: absolute; bottom: 0; left: 0; 
            width: 100%; height: 3px; background: var(--accent);
            border-radius: 3px 3px 0 0;
            transform: scaleX(0); transition: transform 0.3s var(--anim-ease);
            transform-origin: left;
        }
        .sub-link.active::after { transform: scaleX(1); }

        /* Productos */
        .products-canvas {
            padding: 30px 15px 120px 15px; max-width: 1100px; margin: 0 auto;
        }
        .section-title {
            font-family: var(--font-title); font-size: 2rem; font-style: italic; font-weight: 700;
            color: var(--primary); margin: 50px 0 25px 10px;
            scroll-margin-top: 200px; display: flex; align-items: center;
        }
        .section-title::after {
            content: ''; flex: 1; height: 1px;
            background: var(--border-subtle);
            margin-left: 20px;
        }

        .products-grid {
            display: grid; gap: 20px; grid-template-columns: repeat(2, 1fr); 
        }
        .products-grid.view-list { grid-template-columns: 1fr; }
        .products-grid.view-hero { grid-template-columns: 1fr; }
        @media (min-width: 768px) {
            .products-grid { grid-template-columns: repeat(3, 1fr); }
            .products-grid.view-list { grid-template-columns: repeat(2, 1fr); }
            .products-grid.view-hero { grid-template-columns: 1fr; max-width: 650px; margin: 0 auto; }
        }

        /* TARJETAS DE PRODUCTO */
        .product-card {
            background: var(--bg-card);
            border: 1px solid rgba(0,0,0,0.03);
            border-radius: var(--radius-md);
            overflow: hidden; position: relative;
            transition: all 0.3s ease;
            display: flex; flex-direction: column;
            box-shadow: var(--shadow-card);
            cursor: pointer;
        }
        .product-card:active { transform: scale(0.98); }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(197, 157, 95, 0.1); }

        .prod-img-box {
            position: relative; width: 100%; height: 180px; overflow: hidden;
            background: #F4F1EA;
        }
        .prod-img { 
            width: 100%; height: 100%; object-fit: cover; 
            transition: transform 0.5s ease;
        }
        .product-card:hover .prod-img { transform: scale(1.08); }
        
        .view-list .product-card { flex-direction: row; height: 150px; align-items: center; }
        .view-list .prod-img-box { width: 140px; height: 100%; flex-shrink: 0; border-radius: 0; }
        
        .view-hero .product-card { margin-bottom: 40px; border: none; background: transparent; box-shadow: none; }
        .view-hero .prod-img-box { height: 400px; border-radius: var(--radius-md); box-shadow: var(--shadow-card); }
        .view-hero .prod-info { 
            background: rgba(255,255,255,0.9); 
            backdrop-filter: blur(10px);
            margin-top: -30px; 
            margin-left: 20px; 
            margin-right: 20px; 
            border-radius: 15px; 
            padding: 20px; 
            position: relative; 
            z-index: 2;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        .prod-badges {
            position: absolute; top: 12px; left: 12px; z-index: 2; display: flex; gap: 5px;
        }
        .badge {
            font-size: 0.65rem; font-weight: 700; padding: 5px 12px; border-radius: 20px;
            text-transform: uppercase; letter-spacing: 1px;
            background: white; color: var(--primary); 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .prod-info {
            padding: 20px; flex: 1;
            display: flex; flex-direction: column; justify-content: space-between;
        }

        .prod-title {
            font-family: var(--font-title); font-size: 1.15rem; color: var(--primary);
            margin-bottom: 8px; line-height: 1.2; font-weight: 700;
        }
        
        .prod-desc {
            font-size: 0.85rem; color: var(--text-muted); font-weight: 400;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
            margin-bottom: 15px; line-height: 1.5;
        }

        .prod-price {
            font-size: 1.1rem; font-weight: 700; color: var(--accent); letter-spacing: 0.5px;
        }

        /* * ==========================================
         * 5. MODALES (Blancos y Limpios)
         * ==========================================
         */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(16, 42, 67, 0.4); /* Azul muy oscuro transparente */
            backdrop-filter: blur(8px);
            z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s ease;
            display: flex; justify-content: center; align-items: center; 
            padding: 20px;
        }
        .modal-overlay.open { opacity: 1; visibility: visible; }

        .sheet-content {
            background: #fff; width: 100%; max-width: 500px;
            border: none;
            border-radius: var(--radius-lg);
            overflow: hidden; transform: translateY(30px);
            transition: transform 0.4s var(--anim-ease);
            max-height: 90vh; display: flex; flex-direction: column;
            box-shadow: 0 25px 60px rgba(0,0,0,0.15);
        }
        .modal-overlay.open .sheet-content { transform: translateY(0); }

        .sheet-header-img { width: 100%; height: 300px; object-fit: cover; }
        .sheet-close {
            position: absolute; top: 20px; right: 20px;
            width: 40px; height: 40px;
            background: white; border-radius: 50%;
            color: var(--primary); display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; z-index: 5; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            cursor: pointer; transition: transform 0.2s;
        }
        .sheet-close:active { transform: scale(0.9); }

        .sheet-body { padding: 35px; overflow-y: auto; flex: 1; text-align: center; }
        .sheet-title { 
            font-family: var(--font-title); font-size: 2.2rem; font-style: italic;
            margin-bottom: 15px; color: var(--primary); font-weight: 700;
        }
        .sheet-desc { color: var(--text-muted); font-size: 1rem; margin-bottom: 25px; line-height: 1.7; font-weight: 400; }
        
        .sheet-price-display {
            font-size: 1.8rem; color: var(--accent); font-weight: 700; font-family: var(--font-title);
            margin-top: 10px;
        }

        /* --- PROMO MODAL --- */
        .promo-card {
            background: white; width: 90%; max-width: 400px;
            border-radius: 24px;
            overflow: hidden; text-align: center;
            transform: scale(0.9); opacity: 0; transition: all 0.5s ease;
            box-shadow: 0 30px 80px rgba(0,0,0,0.2);
            cursor: pointer; position: relative;
        }
        #promo-modal.open .promo-card { transform: scale(1); opacity: 1; }
        .promo-img { height: 380px; object-fit: cover; opacity: 1; width: 100%; }
        .promo-overlay-text {
            position: absolute; bottom: 0; left: 0; width: 100%;
            padding: 50px 25px 30px 25px;
            /* Gradiente de azul profundo a transparente para leer texto */
            background: linear-gradient(to top, rgba(27, 38, 49, 0.95) 0%, transparent 100%);
            display: flex; flex-direction: column; align-items: center;
        }
        .promo-title { 
            font-family: var(--font-title); color: #fff; 
            font-size: 2rem; font-style: italic; margin-bottom: 8px; 
            text-shadow: 0 2px 15px rgba(0,0,0,0.3);
        }
        .promo-text { color: rgba(255,255,255,0.9); font-size: 1rem; font-weight: 300; }
        .tap-hint {
            margin-top: 20px; font-size: 0.75rem; text-transform: uppercase; 
            letter-spacing: 2px; color: var(--accent); font-weight: 700;
            animation: pulse-txt 2s infinite;
        }
        @keyframes pulse-txt { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }

    </style>
</head>
<body>

    <div id="app-loader">
        <div class="spinner"></div>
    </div>

    <main id="app">
        <!-- VISTA 1: HOME HUB -->
        <section id="home-view">
            <header class="home-header">
                <div class="brand-logo">THE PALM • BEACH</div>
                
                <!-- BOTONES SOCIALES (Se inyectan si hay link) -->
                <div class="home-actions" id="home-actions-container">
                    <!-- JS inyectará aquí los botones -->
                </div>
            </header>
            <div class="category-grid" id="category-grid-container"></div>
        </section>

        <!-- VISTA 2: MENÚ DETALLADO -->
        <section id="menu-view">
            <div class="menu-header-container">
                <div class="nav-controls">
                    <button class="btn-menu-back" id="btn-home" aria-label="Volver">
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                    </button>
                    
                    <div class="search-wrapper">
                        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" class="search-input" id="search-input" placeholder="Buscar...">
                    </div>

                    <div class="view-controls-container">
                        <button class="btn-view-trigger" id="btn-view-trigger" onclick="toggleViewMenu()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                        </button>
                        <div class="view-options-popover" id="view-options-popover">
                            <button class="view-btn active" onclick="switchView('grid')" id="btn-view-grid">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                            </button>
                            <button class="view-btn" onclick="switchView('list')" id="btn-view-list">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                            </button>
                            <button class="view-btn" onclick="switchView('hero')" id="btn-view-hero">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="14" x2="21" y2="14"></line></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="macro-cats-scroll" id="macro-cats-container"></div>
                <div class="sub-nav" id="sub-nav-container"></div>
            </div>

            <div class="products-canvas">
                <div id="products-grid-inner" class="products-grid"></div>
            </div>
        </section>
    </main>

    <!-- MODAL PRODUCTO (SOLO INFORMATIVO) -->
    <div class="modal-overlay" id="product-modal">
        <div class="sheet-content">
            <button class="sheet-close" id="close-sheet">&times;</button>
            <img src="" alt="" class="sheet-header-img" id="sheet-img">
            <div class="sheet-body">
                <h2 class="sheet-title" id="sheet-title"></h2>
                <p class="sheet-desc" id="sheet-desc"></p>
                <div class="sheet-price-display" id="sheet-price"></div>
            </div>
        </div>
    </div>

    <!-- PROMO MODAL NO-BUTTON -->
    <div class="modal-overlay" id="promo-modal">
        <div class="promo-card" onclick="goToPromo()">
            <img src="https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?auto=format&fit=crop&w=600&q=80" alt="Promo" class="promo-img">
            <div class="promo-overlay-text">
                <h3 class="promo-title">Sunset Hour</h3>
                <p class="promo-text">2x1 en Cócteles hasta las 7PM</p>
                <div class="tap-hint">TOCA PARA VER MENÚ</div>
            </div>
        </div>
    </div>

    <script>
        // URL DE TU CMS EN GOOGLE SHEETS
        const API_URL = "https://script.google.com/macros/s/AKfycbyqoAs69igtBuwCyLpWidZJMa4R7wpa02nTT6GU8fBqSfkKvtG18-LfFuiG-E6TWKFl/exec";

        const SAMPLE_DATA = [];

        const state = { products: [], currentCategory: null, currentView: 'grid', searchTerm: '', config: null };
        
        // --- 1. CONEXIÓN API ---
        async function init() {
            try {
                // Fetch a la API con TIMESTAMP para evitar caché
                const response = await fetch(API_URL + "?t=" + new Date().getTime());
                
                if (!response.ok) throw new Error("Error HTTP: " + response.status);
                
                const apiData = await response.json();
                
                // LÓGICA DE DATOS REALES:
                if (apiData) {
                    console.log("✅ Datos cargados desde CMS:", apiData);
                    state.products = apiData.products || []; 
                    state.config = apiData.config || {};
                    
                    aplicarConfiguracionCMS(state.config);
                    renderHome();
                } else {
                    console.warn("⚠️ La API no devolvió datos válidos.");
                }

            } catch (e) {
                console.error("⚠️ Error Fatal CMS:", e);
                document.getElementById('home-view').innerHTML = `
                    <div style="height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; padding: 40px; color: var(--text-main);">
                        <h3 style="color: var(--accent); font-size: 2rem;">⚠️ CONEXIÓN</h3>
                        <p style="margin: 20px 0;">Verificando menú...</p>
                        <button onclick="location.reload()" style="margin-top:30px; padding:12px 25px; background:var(--primary); color:white; border:none; border-radius:30px; font-weight:bold; cursor:pointer;">REINTENTAR</button>
                    </div>
                `;
            }
            
            // Quitar Loader
            document.getElementById('app-loader').style.opacity = '0';
            setTimeout(() => document.getElementById('app-loader').classList.add('hidden'), 600);

            // Verificar Popup
            const popupActivo = state.config ? (String(state.config.ACTIVAR_POPUP).toUpperCase() === "TRUE") : false;
            if(popupActivo && !sessionStorage.getItem('promo_seen')) {
                setTimeout(() => document.getElementById('promo-modal').classList.add('open'), 1500);
            }
        }

        // --- 2. APLICAR BRANDING DEL CMS ---
        function aplicarConfiguracionCMS(config) {
            if(!config) return;

            // Textos Branding
            if(config.NOMBRE_RESTAURANTE) {
                document.querySelector('.brand-logo').textContent = config.NOMBRE_RESTAURANTE;
                document.title = config.NOMBRE_RESTAURANTE;
            }
            
            // Colores
            if(config.COLOR_ACENTO) {
                document.documentElement.style.setProperty('--primary', config.COLOR_ACENTO);
            }

            // Redes Sociales (Inyección Dinámica)
            const actionsContainer = document.getElementById('home-actions-container');
            actionsContainer.innerHTML = ''; // Limpiar

            // Instagram Link
            if(config.LINK_INSTAGRAM && config.LINK_INSTAGRAM.length > 5) {
                actionsContainer.innerHTML += `
                    <a href="${config.LINK_INSTAGRAM}" target="_blank" class="btn-social">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                        Instagram
                    </a>
                `;
            }

            // Reserva Link
            if(config.LINK_RESERVA && config.LINK_RESERVA.length > 5) {
                actionsContainer.innerHTML += `
                    <a href="${config.LINK_RESERVA}" target="_blank" class="btn-social reserve">
                        Reservar
                    </a>
                `;
            }

            // Popup Personalizado
            if(config.TITULO_PROMO) document.querySelector('.promo-title').textContent = config.TITULO_PROMO;
            if(config.SUBTITULO_PROMO) document.querySelector('.promo-text').textContent = config.SUBTITULO_PROMO;
            if(config.IMAGEN_PROMO) document.querySelector('.promo-img').src = config.IMAGEN_PROMO;
        }

        // --- STATE & UI ELEMENTS ---
        const ui = {
            home: document.getElementById('home-view'),
            menu: document.getElementById('menu-view'),
            catGrid: document.getElementById('category-grid-container'),
            macroNav: document.getElementById('macro-cats-container'),
            subNav: document.getElementById('sub-nav-container'),
            productsInner: document.getElementById('products-grid-inner'),
            searchInput: document.getElementById('search-input'),
            viewBtns: { grid: document.getElementById('btn-view-grid'), list: document.getElementById('btn-view-list'), hero: document.getElementById('btn-view-hero') },
            viewPopover: document.getElementById('view-options-popover'),
            viewTrigger: document.getElementById('btn-view-trigger')
        };

        function formatCurrency(val) {
            // Usar símbolo del CMS si existe
            const symbol = (state.config && state.config.MONEDA_SIMBOLO) ? state.config.MONEDA_SIMBOLO : '$';
            return symbol + " " + new Intl.NumberFormat('es-CO', { maximumFractionDigits: 0 }).format(val);
        }

        function renderHome() {
            // Ordenar categorías si vienen del CMS
            const categories = [...new Set(state.products.map(p => p.category))];
            
            ui.catGrid.innerHTML = categories.map(cat => {
                // Buscar imagen específica de la categoría
                const prod = state.products.find(p => p.category === cat && p.category_image);
                const img = prod ? prod.category_image : '';
                
                return `
                    <div class="category-card" onclick="openCategory('${cat}')">
                        <img src="${img}" class="cat-bg" alt="${cat}">
                        <div class="cat-overlay"><h2 class="cat-title">${cat}</h2></div>
                    </div>
                `;
            }).join('');
        }

        window.openCategory = (catName) => {
            // Normalizar string para evitar errores de espacios
            const targetCat = catName.trim();
            state.currentCategory = targetCat;
            state.searchTerm = ''; ui.searchInput.value = '';
            
            // CAMBIO DE FONDO: Playa + Overlay Beige 85%
            document.body.style.backgroundImage = `linear-gradient(rgba(244, 241, 234, 0.85), rgba(244, 241, 234, 0.85)), url('https://images.unsplash.com/photo-1519046904884-53103b34b206?auto=format&fit=crop&w=1200&q=80')`;
            
            // ANIMACIÓN
            ui.home.classList.add('inactive'); 
            ui.menu.classList.add('active');

            const allCats = [...new Set(state.products.map(p => p.category))];
            ui.macroNav.innerHTML = allCats.map(c => `
                <div class="macro-pill ${c === targetCat ? 'active' : ''}" onclick="openCategory('${c}')">${c}</div>
            `).join('');

            renderProducts();
        };

        document.getElementById('btn-home').addEventListener('click', () => {
            ui.menu.classList.remove('active');
            ui.home.classList.remove('inactive'); 
            
            // Restaurar fondo original
            document.body.style.backgroundImage = `var(--bg-gradient)`;
            
            setTimeout(() => ui.menu.scrollTop = 0, 400);
        });

        function renderProducts() {
            let filtered = [];
            if (state.searchTerm.length > 0) {
                const term = state.searchTerm.toLowerCase();
                // Búsqueda extendida a tags
                filtered = state.products.filter(p => 
                    p.name.toLowerCase().includes(term) || 
                    p.description.toLowerCase().includes(term) ||
                    (p.tags && p.tags.toLowerCase().includes(term))
                );
                ui.subNav.innerHTML = ''; 
            } else {
                // Filtrado estricto por categoría normalizada
                filtered = state.products.filter(p => 
                    p.category === state.currentCategory && 
                    (p.active !== false)
                );
                
                // Obtener subcategorías únicas y limpias
                const subs = [...new Set(filtered.map(p => p.subcategory ? p.subcategory.trim() : 'General'))];
                
                ui.subNav.innerHTML = subs.map((sub, i) => `
                    <div class="sub-link ${i===0?'active':''}" 
                         id="link-${sub.replace(/\s+/g,'-')}" 
                         onclick="handleSubClick('${sub}', this)">${sub}</div>
                `).join('');
            }

            if (state.searchTerm.length > 0) {
                 ui.productsInner.innerHTML = filtered.length ? renderCards(filtered) : '<div style="color:var(--text-muted); padding:30px; grid-column:1/-1; text-align:center; font-family:var(--font-title); font-size:1.2rem;">No se encontraron resultados.</div>';
            } else {
                const subs = [...new Set(filtered.map(p => p.subcategory ? p.subcategory.trim() : 'General'))];
                
                ui.productsInner.innerHTML = subs.map(sub => {
                    // Filtrar productos de esta subcategoría
                    const subProds = filtered.filter(p => (p.subcategory ? p.subcategory.trim() : 'General') === sub);
                    return `
                        <div style="grid-column: 1 / -1;" id="sec-${sub.replace(/\s+/g,'-')}">
                            <h3 class="section-title">${sub}</h3>
                        </div>
                        ${renderCards(subProds)}
                    `;
                }).join('');
            }
        }

        window.handleSubClick = (sub, element) => {
            document.querySelectorAll('.sub-link').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            const section = document.getElementById(`sec-${sub.replace(/\s+/g,'-')}`);
            if(section) {
                const y = section.getBoundingClientRect().top + ui.menu.scrollTop - 220;
                ui.menu.scrollTo({top: y, behavior: 'smooth'});
            }
        };

        function renderCards(products) {
            return products.map(prod => `
                <div class="product-card" onclick="openProductModal('${prod.id}')">
                    <div class="prod-img-box">
                        <div class="prod-badges">
                            ${prod.badge ? `<span class="badge">${prod.badge}</span>` : ''}
                            ${prod.tags && prod.tags.includes('Chef') ? `<span class="badge" style="background:#fff;color:#000">Chef</span>` : ''}
                        </div>
                        <img src="${prod.image_url}" class="prod-img" loading="lazy">
                        <!-- BOTÓN ELIMINADO -->
                    </div>
                    <div class="prod-info">
                        <div>
                            <div class="prod-title">${prod.name}</div>
                            <div class="prod-desc">${prod.description}</div>
                        </div>
                        <div class="prod-price">${formatCurrency(prod.price)}</div>
                    </div>
                </div>
            `).join('');
        }

        ui.searchInput.addEventListener('input', (e) => {
            state.searchTerm = e.target.value;
            renderProducts();
        });

        // Toggle View Menu Logic
        window.toggleViewMenu = () => {
            ui.viewPopover.classList.toggle('show');
            // DETIENE EL LATIDO EN EL PRIMER CLIC
            ui.viewTrigger.classList.add('stop-pulse');
        };

        window.switchView = (viewName) => {
            state.currentView = viewName;
            ui.productsInner.className = 'products-grid'; 
            if(viewName === 'list') ui.productsInner.classList.add('view-list');
            if(viewName === 'hero') ui.productsInner.classList.add('view-hero');
            Object.values(ui.viewBtns).forEach(b => b.classList.remove('active'));
            ui.viewBtns[viewName].classList.add('active');
            ui.viewPopover.classList.remove('show'); // Auto close
        };

        // Click outside view menu to close
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.view-controls-container')) {
                ui.viewPopover.classList.remove('show');
            }
        });

        // MODAL PURAMENTE INFORMATIVO
        window.openProductModal = (id) => {
            // Asegurar que la comparación de ID sea texto vs texto
            const prod = state.products.find(p => String(p.id) === String(id));
            if (prod) {
                document.getElementById('sheet-title').innerText = prod.name;
                document.getElementById('sheet-desc').innerText = prod.description;
                document.getElementById('sheet-img').src = prod.image_url;
                document.getElementById('sheet-price').innerText = formatCurrency(prod.price);
                document.getElementById('product-modal').classList.add('open');
            }
        };

        document.getElementById('close-sheet').onclick = () => document.getElementById('product-modal').classList.remove('open');
        // Click en overlay cierra modal
        document.getElementById('product-modal').addEventListener('click', (e) => {
            if(e.target.id === 'product-modal') {
                e.target.classList.remove('open');
            }
        });

        // --- NEW PROMO LOGIC LINKED TO CMS ---
        window.goToPromo = () => {
            document.getElementById('promo-modal').classList.remove('open');
            // Usar la categoría definida en el CMS o default 'Bebidas'
            const targetCat = (state.config && state.config.REDIRIGIR_A_CATEGORIA) ? state.config.REDIRIGIR_A_CATEGORIA : 'Bebidas';
            openCategory(targetCat);
        };

        document.getElementById('promo-modal').addEventListener('click', (e) => {
            if(e.target.id === 'promo-modal') {
                e.target.classList.remove('open');
            }
        });

        // INICIAR CONEXIÓN
        init();
    </script>
</body>
</html>
